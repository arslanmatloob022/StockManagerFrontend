import{w as e,g as t,d as n,a as r,b as s,p as o,c as i,j as a}from"./D_4wJL3I.js";import{d as c}from"./BFnVcjcj.js";import{d}from"./iUM7Auia.js";function u(e,t){if("string"!=typeof e)throw new TypeError("argument str must be a string");const n={},r={},s=r.decode||l;let o=0;for(;o<e.length;){const t=e.indexOf("=",o);if(-1===t)break;let i=e.indexOf(";",o);if(-1===i)i=e.length;else if(i<t){o=e.lastIndexOf(";",t-1)+1;continue}const a=e.slice(o,t).trim();if(!r?.filter||r?.filter(a)){if(void 0===n[a]){let r=e.slice(t+1,i).trim();34===r.codePointAt(0)&&(r=r.slice(1,-1)),n[a]=h(r,s)}o=i+1}else o=i+1}return n}function l(e){return e.includes("%")?decodeURIComponent(e):e}function h(e,t){try{return t(e)}catch{return e}}const f=/^[\u0009\u0020-\u007E\u0080-\u00FF]+$/;function p(e,t,n){const r=n||{},s=r.encode||encodeURIComponent;if("function"!=typeof s)throw new TypeError("option encode is invalid");if(!f.test(e))throw new TypeError("argument name is invalid");const o=s(t);if(o&&!f.test(o))throw new TypeError("argument val is invalid");let i=e+"="+o;if(void 0!==r.maxAge&&null!==r.maxAge){const e=r.maxAge-0;if(Number.isNaN(e)||!Number.isFinite(e))throw new TypeError("option maxAge is invalid");i+="; Max-Age="+Math.floor(e)}if(r.domain){if(!f.test(r.domain))throw new TypeError("option domain is invalid");i+="; Domain="+r.domain}if(r.path){if(!f.test(r.path))throw new TypeError("option path is invalid");i+="; Path="+r.path}if(r.expires){if(a=r.expires,!("[object Date]"===Object.prototype.toString.call(a)||a instanceof Date)||Number.isNaN(r.expires.valueOf()))throw new TypeError("option expires is invalid");i+="; Expires="+r.expires.toUTCString()}var a;if(r.httpOnly&&(i+="; HttpOnly"),r.secure&&(i+="; Secure"),r.priority){switch("string"==typeof r.priority?r.priority.toLowerCase():r.priority){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(r.sameSite){switch("string"==typeof r.sameSite?r.sameSite.toLowerCase():r.sameSite){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return r.partitioned&&(i+="; Partitioned"),i}const y=Object.freeze({ignoreUnknown:!1,respectType:!1,respectFunctionNames:!1,respectFunctionProperties:!1,unorderedObjects:!0,unorderedArrays:!1,unorderedSets:!1,excludeKeys:void 0,excludeValues:void 0,replacer:void 0});function m(e,t){const n=g(t=t?{...y,...t}:y);return n.dispatch(e),n.toString()}const w=Object.freeze(["prototype","__proto__","constructor"]);function g(e){let t="",n=new Map;const r=e=>{t+=e};return{toString:()=>t,getContext:()=>n,dispatch(t){e.replacer&&(t=e.replacer(t));return this[null===t?"null":typeof t](t)},object(t){if(t&&"function"==typeof t.toJSON)return this.object(t.toJSON());const s=Object.prototype.toString.call(t);let o="";const i=s.length;o=i<10?"unknown:["+s+"]":s.slice(8,i-1),o=o.toLowerCase();let a=null;if(void 0!==(a=n.get(t)))return this.dispatch("[CIRCULAR:"+a+"]");if(n.set(t,n.size),"undefined"!=typeof Buffer&&Buffer.isBuffer&&Buffer.isBuffer(t))return r("buffer:"),r(t.toString("utf8"));if("object"!==o&&"function"!==o&&"asyncfunction"!==o)this[o]?this[o](t):e.ignoreUnknown||this.unkown(t,o);else{let n=Object.keys(t);e.unorderedObjects&&(n=n.sort());let s=[];!1===e.respectType||v(t)||(s=w),e.excludeKeys&&(n=n.filter((t=>!e.excludeKeys(t))),s=s.filter((t=>!e.excludeKeys(t)))),r("object:"+(n.length+s.length)+":");const o=n=>{this.dispatch(n),r(":"),e.excludeValues||this.dispatch(t[n]),r(",")};for(const e of n)o(e);for(const e of s)o(e)}},array(t,s){if(s=void 0===s?!1!==e.unorderedArrays:s,r("array:"+t.length+":"),!s||t.length<=1){for(const e of t)this.dispatch(e);return}const o=new Map,i=t.map((t=>{const n=g(e);n.dispatch(t);for(const[e,r]of n.getContext())o.set(e,r);return n.toString()}));return n=o,i.sort(),this.array(i,!1)},date:e=>r("date:"+e.toJSON()),symbol:e=>r("symbol:"+e.toString()),unkown(e,t){if(r(t),e)return r(":"),e&&"function"==typeof e.entries?this.array(Array.from(e.entries()),!0):void 0},error:e=>r("error:"+e.toString()),boolean:e=>r("bool:"+e),string(e){r("string:"+e.length+":"),r(e)},function(t){r("fn:"),v(t)?this.dispatch("[native]"):this.dispatch(t.toString()),!1!==e.respectFunctionNames&&this.dispatch("function-name:"+String(t.name)),e.respectFunctionProperties&&this.object(t)},number:e=>r("number:"+e),xml:e=>r("xml:"+e.toString()),null:()=>r("Null"),undefined:()=>r("Undefined"),regexp:e=>r("regex:"+e.toString()),uint8array(e){return r("uint8array:"),this.dispatch(Array.prototype.slice.call(e))},uint8clampedarray(e){return r("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(e))},int8array(e){return r("int8array:"),this.dispatch(Array.prototype.slice.call(e))},uint16array(e){return r("uint16array:"),this.dispatch(Array.prototype.slice.call(e))},int16array(e){return r("int16array:"),this.dispatch(Array.prototype.slice.call(e))},uint32array(e){return r("uint32array:"),this.dispatch(Array.prototype.slice.call(e))},int32array(e){return r("int32array:"),this.dispatch(Array.prototype.slice.call(e))},float32array(e){return r("float32array:"),this.dispatch(Array.prototype.slice.call(e))},float64array(e){return r("float64array:"),this.dispatch(Array.prototype.slice.call(e))},arraybuffer(e){return r("arraybuffer:"),this.dispatch(new Uint8Array(e))},url:e=>r("url:"+e.toString()),map(t){r("map:");const n=[...t];return this.array(n,!1!==e.unorderedSets)},set(t){r("set:");const n=[...t];return this.array(n,!1!==e.unorderedSets)},file(e){return r("file:"),this.dispatch([e.name,e.size,e.type,e.lastModfied])},blob(){if(e.ignoreUnknown)return r("[blob]");throw new Error('Hashing Blob objects is currently not supported\nUse "options.replacer" or "options.ignoreUnknown"\n')},domwindow:()=>r("domwindow"),bigint:e=>r("bigint:"+e.toString()),process:()=>r("process"),timer:()=>r("timer"),pipe:()=>r("pipe"),tcp:()=>r("tcp"),udp:()=>r("udp"),tty:()=>r("tty"),statwatcher:()=>r("statwatcher"),securecontext:()=>r("securecontext"),connection:()=>r("connection"),zlib:()=>r("zlib"),context:()=>r("context"),nodescript:()=>r("nodescript"),httpparser:()=>r("httpparser"),dataview:()=>r("dataview"),signal:()=>r("signal"),fsevent:()=>r("fsevent"),tlswrap:()=>r("tlswrap")}}const _="[native code] }",b=_.length;function v(e){return"function"==typeof e&&Function.prototype.toString.call(e).slice(-b)===_}const A={NORMAL:0,WILDCARD:1,PLACEHOLDER:2};function x(e={}){const t={options:e,rootNode:C(),staticRoutesMap:{}},n=t=>e.strictTrailingSlash?t:t.replace(/\/$/,"")||"/";if(e.routes)for(const r in e.routes)E(t,n(r),e.routes[r]);return{ctx:t,lookup:e=>function(e,t){const n=e.staticRoutesMap[t];if(n)return n.data;const r=t.split("/"),s={};let o=!1,i=null,a=e.rootNode,c=null;for(let d=0;d<r.length;d++){const e=r[d];null!==a.wildcardChildNode&&(i=a.wildcardChildNode,c=r.slice(d).join("/"));const t=a.children.get(e);if(void 0===t){if(a&&a.placeholderChildren.length>1){const e=r.length-d;a=a.placeholderChildren.find((t=>t.maxDepth===e))||null}else a=a.placeholderChildren[0]||null;if(!a)break;a.paramName&&(s[a.paramName]=e),o=!0}else a=t}null!==a&&null!==a.data||null===i||(a=i,s[a.paramName||"_"]=c,o=!0);if(!a)return null;if(o)return{...a.data,params:o?s:void 0};return a.data}(t,n(e)),insert:(e,r)=>E(t,n(e),r),remove:e=>function(e,t){let n=!1;const r=t.split("/");let s=e.rootNode;for(const o of r)if(s=s.children.get(o),!s)return n;if(s.data){const e=r.at(-1)||"";s.data=null,0===Object.keys(s.children).length&&s.parent&&(s.parent.children.delete(e),s.parent.wildcardChildNode=null,s.parent.placeholderChildren=[]),n=!0}return n}(t,n(e))}}function E(e,t,n){let r=!0;const s=t.split("/");let o=e.rootNode,i=0;const a=[o];for(const c of s){let e;if(e=o.children.get(c))o=e;else{const t=S(c);e=C({type:t,parent:o}),o.children.set(c,e),t===A.PLACEHOLDER?(e.paramName="*"===c?"_"+i++:c.slice(1),o.placeholderChildren.push(e),r=!1):t===A.WILDCARD&&(o.wildcardChildNode=e,e.paramName=c.slice(3)||"_",r=!1),a.push(e),o=e}}for(const[c,d]of a.entries())d.maxDepth=Math.max(a.length-c,d.maxDepth||0);return o.data=n,!0===r&&(e.staticRoutesMap[t]=o),o}function C(e={}){return{type:e.type||A.NORMAL,maxDepth:0,parent:e.parent||null,children:new Map,data:e.data||null,paramName:e.paramName||null,wildcardChildNode:null,placeholderChildren:[]}}function S(e){return e.startsWith("**")?A.WILDCARD:":"===e[0]||"*"===e?A.PLACEHOLDER:A.NORMAL}function k(e){return function(e,t){return{ctx:{table:e},matchAll:n=>R(n,e,t)}}(O("",e.ctx.rootNode),e.ctx.options.strictTrailingSlash)}function R(e,t,n){!0!==n&&e.endsWith("/")&&(e=e.slice(0,-1)||"/");const r=[];for(const[o,i]of M(t.wildcard))(e===o||e.startsWith(o+"/"))&&r.push(i);for(const[o,i]of M(t.dynamic))if(e.startsWith(o+"/")){const t="/"+e.slice(o.length).split("/").splice(2).join("/");r.push(...R(t,i))}const s=t.static.get(e);return s&&r.push(s),r.filter(Boolean)}function M(e){return[...e.entries()].sort(((e,t)=>e[0].length-t[0].length))}function O(e,t){const n={static:new Map,wildcard:new Map,dynamic:new Map};return function e(t,r){if(t)if(r.type!==A.NORMAL||t.includes("*")||t.includes(":")){if(r.type===A.WILDCARD)n.wildcard.set(t.replace("/**",""),r.data);else if(r.type===A.PLACEHOLDER){const e=O("",r);return r.data&&e.static.set("/",r.data),void n.dynamic.set(t.replace(/\/\*|\/:\w+/,""),e)}}else r.data&&n.static.set(t,r.data);for(const[n,s]of r.children.entries())e(`${t}/${n}`.replace("//","/"),s)}(e,t),n}const T=globalThis.crypto,q={randomUUID:()=>T.randomUUID(),getRandomValues:e=>T.getRandomValues(e),subtle:T.subtle};var H={},j=Array.from({length:64});for(let or=0,ir="A".charCodeAt(0),ar="Z".charCodeAt(0);or+ir<=ar;or++){const e=String.fromCharCode(or+ir);H[e]=or,j[or]=e}for(let or=0,ir="a".charCodeAt(0),ar="z".charCodeAt(0);or+ir<=ar;or++){const e=String.fromCharCode(or+ir),t=or+26;H[e]=t,j[t]=e}for(let or=0;or<10;or++){H[or.toString(10)]=or+52;const e=or.toString(10),t=or+52;H[e]=t,j[t]=e}H["-"]=62,j[62]="-",H._=63,j[63]="_";var L=e=>(new TextEncoder).encode(e),N=e=>{const t=e+"=".repeat((4-e.length%4)%4);let n=t.length/4*3;t.endsWith("==")?n-=2:t.endsWith("=")&&n--;const r=new ArrayBuffer(n),s=new DataView(r);for(let o=0;o<t.length;o+=4){let e=0,n=0;for(let s=o,a=o+3;s<=a;s++)if("="===t[s])e>>=6;else{if(!(t[s]in H))throw new TypeError(`Invalid character ${t[s]} in base64 string.`);e|=H[t[s]]<<6*(a-s),n+=6}const r=o/4*3;e>>=n%8;const i=Math.floor(n/8);for(let t=0;t<i;t++){const n=8*(i-t-1);s.setUint8(r+t,(e&255<<n)>>n)}}return new Uint8Array(r)},B=e=>{const t="string"==typeof e?L(e):e;let n="";for(let r=0;r<t.length;r+=3){let e=0,s=0;for(let n=r,i=Math.min(r+3,t.length);n<i;n++)e|=t[n]<<8*(i-n-1),s+=8;const o=Math.ceil(s/6);e<<=6*o-s;for(let t=1;t<=o;t++){const r=6*(o-t);n+=j[(e&63<<r)>>r]}}return n},D={encryption:{saltBits:256,algorithm:"aes-256-cbc",iterations:1,minPasswordlength:32},integrity:{saltBits:256,algorithm:"sha256",iterations:1,minPasswordlength:32},ttl:0,timestampSkewSec:60,localtimeOffsetMsec:0},P=e=>({...e,encryption:{...e.encryption},integrity:{...e.integrity}}),I={"aes-128-ctr":{keyBits:128,ivBits:128,name:"AES-CTR"},"aes-256-cbc":{keyBits:256,ivBits:128,name:"AES-CBC"},sha256:{keyBits:256,name:"SHA-256"}},$="Fe26.2",U=(e,t)=>{if(t<1)throw new Error("Invalid random bits count");return((e,t)=>{const n=new Uint8Array(t);return e.getRandomValues(n),n})(e,Math.ceil(t/8))},F=async(e,t,n)=>{var r;if(!(null==t?void 0:t.length))throw new Error("Empty password");if(null==n||"object"!=typeof n)throw new Error("Bad options");if(!(n.algorithm in I))throw new Error(`Unknown algorithm: ${n.algorithm}`);const s=I[n.algorithm],o={},i=null!=(r=n.hmac)&&r,a=i?{name:"HMAC",hash:s.name}:{name:s.name},c=i?["sign","verify"]:["encrypt","decrypt"];if("string"==typeof t){if(t.length<n.minPasswordlength)throw new Error(`Password string too short (min ${n.minPasswordlength} characters required)`);let{salt:r=""}=n;if(!r){const{saltBits:t=0}=n;if(!t)throw new Error("Missing salt and saltBits options");const s=U(e,t);r=[...new Uint8Array(s)].map((e=>e.toString(16).padStart(2,"0"))).join("")}const i=await(async(e,t,n,r,s,o)=>{const i=L(t),a=await e.subtle.importKey("raw",i,{name:"PBKDF2"},!1,["deriveBits"]),c={name:"PBKDF2",hash:o,salt:L(n),iterations:r};return await e.subtle.deriveBits(c,a,8*s)})(e,t,r,n.iterations,s.keyBits/8,"SHA-1"),d=await e.subtle.importKey("raw",i,a,!1,c);o.key=d,o.salt=r}else{if(t.length<s.keyBits/8)throw new Error("Key buffer (password) too small");o.key=await e.subtle.importKey("raw",t,a,!1,c),o.salt=""}return n.iv?o.iv=n.iv:"ivBits"in s&&(o.iv=U(e,s.ivBits)),o},W=(e,t,n)=>["aes-128-ctr"===e?{name:"AES-CTR",counter:t.iv,length:128}:{name:"AES-CBC",iv:t.iv},t.key,"string"==typeof n?L(n):n],z=async(e,t,n,r)=>{const s=await F(e,t,n),o=await e.subtle.decrypt(...W(n.algorithm,s,r));return i=new Uint8Array(o),(new TextDecoder).decode(i);var i},K=async(e,t,n,r)=>{const s=await F(e,t,{...n,hmac:!0}),o=L(r),i=await e.subtle.sign({name:"HMAC"},s.key,o);return{digest:B(new Uint8Array(i)),salt:s.salt}},J=e=>"string"==typeof e||e instanceof Uint8Array?{encryption:e,integrity:e}:"secret"in e?{id:e.id,encryption:e.secret,integrity:e.secret}:{id:e.id,encryption:e.encryption,integrity:e.integrity},V=async(e,t,n,r)=>{if(!n)throw new Error("Empty password");const s=P(r),o=Date.now()+(s.localtimeOffsetMsec||0),i=JSON.stringify(t),a=J(n),{id:c="",encryption:d,integrity:u}=a;if(c&&!/^\w+$/.test(c))throw new Error("Invalid password id");const{encrypted:l,key:h}=await(async(e,t,n,r)=>{const s=await F(e,t,n),o=await e.subtle.encrypt(...W(n.algorithm,s,r));return{encrypted:new Uint8Array(o),key:s}})(e,d,s.encryption,i),f=B(new Uint8Array(l)),p=B(h.iv),y=s.ttl?o+s.ttl:"",m=`${$}*${c}*${h.salt}*${p}*${f}*${y}`,w=await K(e,u,s.integrity,m);return`${m}*${w.salt}*${w.digest}`},G=async(e,t,n,r)=>{if(!n)throw new Error("Empty password");const s=P(r),o=Date.now()+(s.localtimeOffsetMsec||0),i=t.split("*");if(8!==i.length)throw new Error("Incorrect number of sealed components");const a=i[0];let c=i[1];const d=i[2],u=i[3],l=i[4],h=i[5],f=i[6],p=i[7],y=`${a}*${c}*${d}*${u}*${l}*${h}`;if($!==a)throw new Error("Wrong mac prefix");if(h){if(!/^\d+$/.test(h))throw new Error("Invalid expiration");if(Number.parseInt(h,10)<=o-1e3*s.timestampSkewSec)throw new Error("Expired seal")}let m="";if(c=c||"default","string"==typeof n||n instanceof Uint8Array)m=n;else{if(!(c in n))throw new Error(`Cannot find password: ${c}`);m=n[c]}m=J(m);const w=s.integrity;w.salt=f;if(!((e,t)=>{let n=e.length===t.length?0:1;n&&(t=e);for(let r=0;r<e.length;r+=1)n|=e.charCodeAt(r)^t.charCodeAt(r);return 0===n})((await K(e,m.integrity,w,y)).digest,p))throw new Error("Bad hmac value");const g=N(l),_=s.encryption;_.salt=d,_.iv=N(u);const b=await z(e,m.encryption,_,g);return b?JSON.parse(b):null};function Y(e){throw new Error(`[unenv] ${e} is not implemented yet!`)}let X=10,Z=class{__unenv__=!0;_events=Object.create(null);_maxListeners;static get defaultMaxListeners(){return X}static set defaultMaxListeners(e){if("number"!=typeof e||e<0||Number.isNaN(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");X=e}setMaxListeners(e){if("number"!=typeof e||e<0||Number.isNaN(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this}getMaxListeners(){return te(this)}emit(e,...t){if(!this._events[e]||0===this._events[e].length)return!1;if("error"===e){let e;if(t.length>0&&(e=t[0]),e instanceof Error)throw e;const n=new Error("Unhandled error."+(e?" ("+e.message+")":""));throw n.context=e,n}for(const n of this._events[e])(n.listener||n).apply(this,t);return!0}addListener(e,t){return Q(this,e,t,!1)}on(e,t){return Q(this,e,t,!1)}prependListener(e,t){return Q(this,e,t,!0)}once(e,t){return this.on(e,ee(this,e,t))}prependOnceListener(e,t){return this.prependListener(e,ee(this,e,t))}removeListener(e,t){return function(e,t,n){if(re(n),!e._events[t]||0===e._events[t].length)return e;const r=e._events[t].length;if(e._events[t]=e._events[t].filter((e=>e!==n)),r===e._events[t].length)return e;e._events.removeListener&&e.emit("removeListener",t,n.listener||n);0===e._events[t].length&&delete e._events[t];return e}(this,e,t)}off(e,t){return this.removeListener(e,t)}removeAllListeners(e){return function(e,t){if(!e._events[t]||0===e._events[t].length)return e;if(e._events.removeListener)for(const n of e._events[t])e.emit("removeListener",t,n.listener||n);return delete e._events[t],e}(this,e)}listeners(e){return ne(this,e,!0)}rawListeners(e){return ne(this,e,!1)}listenerCount(e){return this.rawListeners(e).length}eventNames(){return Object.keys(this._events)}};function Q(e,t,n,r){re(n),void 0!==e._events.newListener&&e.emit("newListener",t,n.listener||n),e._events[t]||(e._events[t]=[]),r?e._events[t].unshift(n):e._events[t].push(n);const s=te(e);if(s>0&&e._events[t].length>s&&!e._events[t].warned){e._events[t].warned=!0;const n=new Error(`[unenv] Possible EventEmitter memory leak detected. ${e._events[t].length} ${t} listeners added. Use emitter.setMaxListeners() to increase limit`);n.name="MaxListenersExceededWarning",n.emitter=e,n.type=t,n.count=e._events[t]?.length,console.warn(n)}return e}function ee(e,t,n){let r=!1;const s=(...o)=>{if(!r)return e.removeListener(t,s),r=!0,0===o.length?n.call(e):n.apply(e,o)};return s.listener=n,s}function te(e){return e._maxListeners??Z.defaultMaxListeners}function ne(e,t,n){let r=e._events[t];return"function"==typeof r&&(r=[r]),n?r.map((e=>e.listener||e)):r}function re(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}const se=globalThis.EventEmitter||Z;class oe extends se{__unenv__=!0;readableEncoding=null;readableEnded=!0;readableFlowing=!1;readableHighWaterMark=0;readableLength=0;readableObjectMode=!1;readableAborted=!1;readableDidRead=!1;closed=!1;errored=null;readable=!1;destroyed=!1;static from(e,t){return new oe(t)}constructor(e){super()}_read(e){}read(e){}setEncoding(e){return this}pause(){return this}resume(){return this}isPaused(){return!0}unpipe(e){return this}unshift(e,t){}wrap(e){return this}push(e,t){return!1}_destroy(e,t){this.removeAllListeners()}destroy(e){return this.destroyed=!0,this._destroy(e),this}pipe(e,t){return{}}compose(e,t){throw new Error("[unenv] Method not implemented.")}[Symbol.asyncDispose](){return this.destroy(),Promise.resolve()}async*[Symbol.asyncIterator](){throw Y("Readable.asyncIterator")}iterator(e){throw Y("Readable.iterator")}map(e,t){throw Y("Readable.map")}filter(e,t){throw Y("Readable.filter")}forEach(e,t){throw Y("Readable.forEach")}reduce(e,t,n){throw Y("Readable.reduce")}find(e,t){throw Y("Readable.find")}findIndex(e,t){throw Y("Readable.findIndex")}some(e,t){throw Y("Readable.some")}toArray(e){throw Y("Readable.toArray")}every(e,t){throw Y("Readable.every")}flatMap(e,t){throw Y("Readable.flatMap")}drop(e,t){throw Y("Readable.drop")}take(e,t){throw Y("Readable.take")}asIndexedPairs(e){throw Y("Readable.asIndexedPairs")}}const ie=globalThis.Readable||oe;const ae=globalThis.Writable||class extends se{__unenv__=!0;writable=!0;writableEnded=!1;writableFinished=!1;writableHighWaterMark=0;writableLength=0;writableObjectMode=!1;writableCorked=0;closed=!1;errored=null;writableNeedDrain=!1;destroyed=!1;_data;_encoding="utf-8";constructor(e){super()}pipe(e,t){return{}}_write(e,t,n){if(this.writableEnded)n&&n();else{if(void 0===this._data)this._data=e;else{const n="string"==typeof this._data?Buffer.from(this._data,this._encoding||t||"utf8"):this._data,r="string"==typeof e?Buffer.from(e,t||this._encoding||"utf8"):e;this._data=Buffer.concat([n,r])}this._encoding=t,n&&n()}}_writev(e,t){}_destroy(e,t){}_final(e){}write(e,t,n){const r="string"==typeof t?this._encoding:"utf-8",s="function"==typeof t?t:"function"==typeof n?n:void 0;return this._write(e,r,s),!0}setDefaultEncoding(e){return this}end(e,t,n){const r="function"==typeof e?e:"function"==typeof t?t:"function"==typeof n?n:void 0;if(this.writableEnded)return r&&r(),this;const s=e===r?void 0:e;if(s){const e=t===r?void 0:t;this.write(s,e,r)}return this.writableEnded=!0,this.writableFinished=!0,this.emit("close"),this.emit("finish"),this}cork(){}uncork(){}destroy(e){return this.destroyed=!0,delete this._data,this.removeAllListeners(),this}compose(e,t){throw new Error("[h3] Method not implemented.")}},ce=class{allowHalfOpen=!0;_destroy;constructor(e=new ie,t=new ae){Object.assign(this,e),Object.assign(this,t),this._destroy=function(...e){return function(...t){for(const n of e)n(...t)}}(e._destroy,t._destroy)}};function de(){return Object.assign(ce.prototype,ie.prototype),Object.assign(ce.prototype,ae.prototype),ce}const ue=de(),le=globalThis.Duplex||ue;class he extends le{__unenv__=!0;bufferSize=0;bytesRead=0;bytesWritten=0;connecting=!1;destroyed=!1;pending=!1;localAddress="";localPort=0;remoteAddress="";remoteFamily="";remotePort=0;autoSelectFamilyAttemptedAddresses=[];readyState="readOnly";constructor(e){super()}write(e,t,n){return!1}connect(e,t,n){return this}end(e,t,n){return this}setEncoding(e){return this}pause(){return this}resume(){return this}setTimeout(e,t){return this}setNoDelay(e){return this}setKeepAlive(e,t){return this}address(){return{}}unref(){return this}ref(){return this}destroySoon(){this.destroy()}resetAndDestroy(){const e=new Error("ERR_SOCKET_CLOSED");return e.code="ERR_SOCKET_CLOSED",this.destroy(e),this}}class fe extends ie{__unenv__={};aborted=!1;httpVersion="1.1";httpVersionMajor=1;httpVersionMinor=1;complete=!0;connection;socket;headers={};trailers={};method="GET";url="/";statusCode=200;statusMessage="";closed=!1;errored=null;readable=!1;constructor(e){super(),this.socket=this.connection=e||new he}get rawHeaders(){return function(e){const t=[];for(const n in e)if(Array.isArray(e[n]))for(const r of e[n])t.push(n,r);else t.push(n,e[n]);return t}(this.headers)}get rawTrailers(){return[]}setTimeout(e,t){return this}get headersDistinct(){return pe(this.headers)}get trailersDistinct(){return pe(this.trailers)}}function pe(e){const t={};for(const[n,r]of Object.entries(e))n&&(t[n]=(Array.isArray(r)?r:[r]).filter(Boolean));return t}class ye extends ae{__unenv__=!0;statusCode=200;statusMessage="";upgrading=!1;chunkedEncoding=!1;shouldKeepAlive=!1;useChunkedEncodingByDefault=!1;sendDate=!1;finished=!1;headersSent=!1;strictContentLength=!1;connection=null;socket=null;req;_headers={};constructor(e){super(),this.req=e}assignSocket(e){e._httpMessage=this,this.socket=e,this.connection=e,this.emit("socket",e),this._flush()}_flush(){this.flushHeaders()}detachSocket(e){}writeContinue(e){}writeHead(e,t,n){e&&(this.statusCode=e),"string"==typeof t&&(this.statusMessage=t,t=void 0);const r=n||t;if(r)if(Array.isArray(r));else for(const s in r)this.setHeader(s,r[s]);return this.headersSent=!0,this}writeProcessing(){}setTimeout(e,t){return this}appendHeader(e,t){e=e.toLowerCase();const n=this._headers[e],r=[...Array.isArray(n)?n:[n],...Array.isArray(t)?t:[t]].filter(Boolean);return this._headers[e]=r.length>1?r:r[0],this}setHeader(e,t){return this._headers[e.toLowerCase()]=t,this}getHeader(e){return this._headers[e.toLowerCase()]}getHeaders(){return this._headers}getHeaderNames(){return Object.keys(this._headers)}hasHeader(e){return e.toLowerCase()in this._headers}removeHeader(e){delete this._headers[e.toLowerCase()]}addTrailers(e){}flushHeaders(){}writeEarlyHints(e,t){"function"==typeof t&&t()}}function me(t,n){return(t=e(t))&&"/"!==t?Mn((async e=>{e.node.req.originalUrl=e.node.req.originalUrl||e.node.req.url||"/";const r=e._path||e.node.req.url||"/";e._path=i(e.path||"/",t),e.node.req.url=e._path;try{return await n(e)}finally{e._path=e.node.req.url=r}})):n}function we(e,t){try{return t in e}catch{return!1}}var ge=Object.defineProperty,_e=(e,t,n)=>(((e,t,n)=>{t in e?ge(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class be extends Error{constructor(e,t={}){super(e,t),_e(this,"statusCode",500),_e(this,"fatal",!1),_e(this,"unhandled",!1),_e(this,"statusMessage"),_e(this,"data"),_e(this,"cause"),t.cause&&!this.cause&&(this.cause=t.cause)}toJSON(){const e={message:this.message,statusCode:it(this.statusCode,500)};return this.statusMessage&&(e.statusMessage=ot(this.statusMessage)),void 0!==this.data&&(e.data=this.data),e}}function ve(e){if("string"==typeof e)return new be(e);if(xe(e))return e;const t=new be(e.message??e.statusMessage??"",{cause:e.cause||e});if(we(e,"stack"))try{Object.defineProperty(t,"stack",{get:()=>e.stack})}catch{try{t.stack=e.stack}catch{}}if(e.data&&(t.data=e.data),e.statusCode?t.statusCode=it(e.statusCode,t.statusCode):e.status&&(t.statusCode=it(e.status,t.statusCode)),e.statusMessage?t.statusMessage=e.statusMessage:e.statusText&&(t.statusMessage=e.statusText),t.statusMessage){const e=t.statusMessage;ot(t.statusMessage)!==e&&console.warn("[h3] Please prefer using `message` for longer error messages instead of `statusMessage`. In the future, `statusMessage` will be sanitized by default.")}return void 0!==e.fatal&&(t.fatal=e.fatal),void 0!==e.unhandled&&(t.unhandled=e.unhandled),t}function Ae(e,t,n){if(e.handled)return;const r=xe(t)?t:ve(t),s={statusCode:r.statusCode,statusMessage:r.statusMessage,stack:[],data:r.data};if(n&&(s.stack=(r.stack||"").split("\n").map((e=>e.trim()))),e.handled)return;mt(e,Number.parseInt(r.statusCode),r.statusMessage),e.node.res.setHeader("content-type",rt.json),e.node.res.end(JSON.stringify(s,void 0,2))}function xe(e){return!0===e?.constructor?.__h3_error__}function Ee(e,t){const n={},r=t.find((e=>"content-disposition"===e[0]))?.[1]||"";for(const o of r.split(";")){const e=o.split("=");if(2!==e.length)continue;const t=(e[0]||"").trim();if("name"===t||"filename"===t){const r=(e[1]||"").trim().replace(/"/g,"");n[t]=Buffer.from(r,"latin1").toString("utf8")}}const s=t.find((e=>"content-type"===e[0]))?.[1]||"";return s&&(n.type=s),n.data=Buffer.from(e),n}async function Ce(e,t){try{const n=await t(e);if(!1===n)throw Se();return!0===n?e:n??e}catch(n){throw Se(n)}}function Se(e){throw ve({status:400,statusMessage:"Validation Error",message:e?.message||"Validation Error",data:e})}function ke(e){return t(e.path||"")}function Re(e,t){return Ce(ke(e),t)}function Me(e,t={}){let r=e.context.params||{};if(t.decode){r={...r};for(const e in r)r[e]=n(r[e])}return r}function Oe(e,t,n={}){return Ce(Me(e,n),t)}function Te(e,t,n={}){return Me(e,n)[t]}function qe(e,t="GET"){return(e.node.req.method||t).toUpperCase()}function He(e,t,n){if(n&&"HEAD"===e.method)return!0;if("string"==typeof t){if(e.method===t)return!0}else if(t.includes(e.method))return!0;return!1}function je(e,t,n){if(!He(e,t,n))throw ve({statusCode:405,statusMessage:"HTTP method is not allowed."})}function Le(e){const t={};for(const n in e.node.req.headers){const r=e.node.req.headers[n];t[n]=Array.isArray(r)?r.filter(Boolean).join(", "):r}return t}_e(be,"__h3_error__",!0);const Ne=Le;function Be(e,t){return Le(e)[t.toLowerCase()]}const De=Be;function Pe(e,t={}){if(t.xForwardedHost){const t=e.node.req.headers["x-forwarded-host"];if(t)return t}return e.node.req.headers.host||"localhost"}function Ie(e,t={}){return!1!==t.xForwardedProto&&"https"===e.node.req.headers["x-forwarded-proto"]||e.node.req.connection?.encrypted?"https":"http"}const $e=/[/\\]{2,}/g;function Ue(e){return(e.node.req.url||"/").replace($e,"/")}function Fe(e,t={}){const n=Pe(e,t),r=Ie(e),s=(e.node.req.originalUrl||e.path).replace(/^[/\\]+/g,"/");return new URL(s,`${r}://${n}`)}function We(e){return e.web?.request||new Request(Fe(e),{duplex:"half",method:e.method,headers:e.headers,body:et(e)})}function ze(e,t={}){if(e.context.clientAddress)return e.context.clientAddress;if(t.xForwardedFor){const t=Be(e,"x-forwarded-for")?.split(",").shift()?.trim();if(t)return t}return e.node.req.socket.remoteAddress?e.node.req.socket.remoteAddress:void 0}const Ke=Symbol.for("h3RawBody"),Je=Symbol.for("h3ParsedBody"),Ve=["PATCH","POST","PUT","DELETE"];function Ge(e,t="utf8"){je(e,Ve);const n=e._requestBody||e.web?.request?.body||e.node.req[Ke]||e.node.req.rawBody||e.node.req.body;if(n){const e=Promise.resolve(n).then((e=>Buffer.isBuffer(e)?e:"function"==typeof e.pipeTo?new Promise(((t,n)=>{const r=[];e.pipeTo(new WritableStream({write(e){r.push(e)},close(){t(Buffer.concat(r))},abort(e){n(e)}})).catch(n)})):"function"==typeof e.pipe?new Promise(((t,n)=>{const r=[];e.on("data",(e=>{r.push(e)})).on("end",(()=>{t(Buffer.concat(r))})).on("error",n)})):e.constructor===Object?Buffer.from(JSON.stringify(e)):Buffer.from(e)));return t?e.then((e=>e.toString(t))):e}if(!Number.parseInt(e.node.req.headers["content-length"]||""))return Promise.resolve(void 0);const r=e.node.req[Ke]=new Promise(((t,n)=>{const r=[];e.node.req.on("error",(e=>{n(e)})).on("data",(e=>{r.push(e)})).on("end",(()=>{t(Buffer.concat(r))}))}));return t?r.then((e=>e.toString(t))):r}async function Ye(e,t={}){const n=e.node.req;if(we(n,Je))return n[Je];const r=n.headers["content-type"]||"",s=await Ge(e);let o;return o="application/json"===r?tt(s,t.strict??!0):r.startsWith("application/x-www-form-urlencoded")?function(e){const t=new URLSearchParams(e),n=Object.create(null);for(const[r,s]of t.entries())we(n,r)?(Array.isArray(n[r])||(n[r]=[n[r]]),n[r].push(s)):n[r]=s;return n}(s):r.startsWith("text/")?s:tt(s,t.strict??!1),n[Je]=o,o}async function Xe(e,t){return Ce(await Ye(e,{strict:!0}),t)}async function Ze(e){const t=Be(e,"content-type");if(!t||!t.startsWith("multipart/form-data"))return;const n=t.match(/boundary=([^;]*)(;|$)/i)?.[1];if(!n)return;const r=await Ge(e,!1);return r?function(e,t){let n="",r=0,s=[];const o=[];let i=[];for(let a=0;a<e.length;a++){const c=a>0?e[a-1]:null,d=e[a];10===d||13===d||(n+=String.fromCodePoint(d));const u=10===d&&13===c;if(0===r&&u)"--"+t===n&&(r=1),n="";else if(1===r&&u){if(n.length>0){const e=n.indexOf(":");if(e>0){const t=n.slice(0,e).toLowerCase(),r=n.slice(e+1).trim();i.push([t,r])}}else r=2,s=[];n=""}else if(2===r){if(n.length>t.length+4&&(n=""),"--"+t===n){const e=s.length-n.length,t=s.slice(0,e-1);o.push(Ee(t,i)),s=[],i=[],n="",r=3}else s.push(d);u&&(n="")}else 3===r&&u&&(r=1)}return o}(r,n):void 0}async function Qe(e){return await We(e).formData()}function et(e){if(!Ve.includes(e.method))return;const t=e.web?.request?.body||e._requestBody;if(t)return t;return Ke in e.node.req||"rawBody"in e.node.req||"body"in e.node.req||"__unenv__"in e.node.req?new ReadableStream({async start(t){const n=await Ge(e,!1);n&&t.enqueue(n),t.close()}}):new ReadableStream({start:t=>{e.node.req.on("data",(e=>{t.enqueue(e)})),e.node.req.on("end",(()=>{t.close()})),e.node.req.on("error",(e=>{t.error(e)}))}})}function tt(e="",t){if(e)try{return c(e,{strict:t})}catch{throw ve({statusCode:400,statusMessage:"Bad Request",message:"Invalid JSON body"})}}function nt(e,t){const n=["public",...t.cacheControls||[]];let r=!1;if(void 0!==t.maxAge&&n.push("max-age="+ +t.maxAge,"s-maxage="+ +t.maxAge),t.modifiedTime){const n=new Date(t.modifiedTime),s=e.node.req.headers["if-modified-since"];e.node.res.setHeader("last-modified",n.toUTCString()),s&&new Date(s)>=t.modifiedTime&&(r=!0)}if(t.etag){e.node.res.setHeader("etag",t.etag);e.node.req.headers["if-none-match"]===t.etag&&(r=!0)}return e.node.res.setHeader("cache-control",n.join(", ")),!!r&&(e.node.res.statusCode=304,e.handled||e.node.res.end(),!0)}const rt={html:"text/html",json:"application/json"},st=/[^\u0009\u0020-\u007E]/g;function ot(e=""){return e.replace(st,"")}function it(e,t=200){return e?("string"==typeof e&&(e=Number.parseInt(e,10)),e<100||e>999?t:e):t}function at(e){return u(e.node.req.headers.cookie||"")}function ct(e,t){return at(e)[t]}function dt(e,t,n,r){const s=p(t,n,r={path:"/",...r});let o=e.node.res.getHeader("set-cookie");Array.isArray(o)||(o=[o]);const i=m(r);o=o.filter((e=>e&&i!==m(u(e)))),e.node.res.setHeader("set-cookie",[...o,s])}function ut(e,t,n){dt(e,t,"",{...n,maxAge:0})}function lt(e){if(Array.isArray(e))return e.flatMap((e=>lt(e)));if("string"!=typeof e)return[];const t=[];let n,r,s,o,i,a=0;const c=()=>{for(;a<e.length&&/\s/.test(e.charAt(a));)a+=1;return a<e.length};for(;a<e.length;){for(n=a,i=!1;c();)if(r=e.charAt(a),","===r){for(s=a,a+=1,c(),o=a;a<e.length&&(r=e.charAt(a),"="!==r&&";"!==r&&","!==r);)a+=1;a<e.length&&"="===e.charAt(a)?(i=!0,a=o,t.push(e.slice(n,s)),n=a):a=s+1}else a+=1;(!i||a>=e.length)&&t.push(e.slice(n,e.length))}return t}function ht(e){switch(typeof e){case"string":return e;case"boolean":case"number":case"bigint":case"symbol":return e.toString();case"function":case"undefined":return;case"object":return e instanceof Uint8Array?e:JSON.stringify(e)}}const ft="undefined"==typeof setImmediate?e=>e():setImmediate;function pt(e,t,n){return n&&_t(e,n),new Promise((n=>{ft((()=>{e.handled||e.node.res.end(t),n()}))}))}function yt(e,t){if(e.handled)return;t||200===e.node.res.statusCode||(t=e.node.res.statusCode);const n=it(t,204);204===n&&e.node.res.removeHeader("content-length"),e.node.res.writeHead(n),e.node.res.end()}function mt(e,t,n){t&&(e.node.res.statusCode=it(t,e.node.res.statusCode)),n&&(e.node.res.statusMessage=ot(n))}function wt(e){return e.node.res.statusCode}function gt(e){return e.node.res.statusMessage}function _t(e,t){t&&304!==e.node.res.statusCode&&!e.node.res.getHeader("content-type")&&e.node.res.setHeader("content-type",t)}function bt(e,t,n=302){e.node.res.statusCode=it(n,e.node.res.statusCode),e.node.res.setHeader("location",t);return pt(e,`<!DOCTYPE html><html><head><meta http-equiv="refresh" content="0; url=${t.replace(/"/g,"%22")}"></head></html>`,rt.html)}function vt(e){return e.node.res.getHeaders()}function At(e,t){return e.node.res.getHeader(t)}function xt(e,t){for(const[n,r]of Object.entries(t))e.node.res.setHeader(n,r)}const Et=xt;function Ct(e,t,n){e.node.res.setHeader(t,n)}const St=Ct;function kt(e,t){for(const[n,r]of Object.entries(t))Mt(e,n,r)}const Rt=kt;function Mt(e,t,n){let r=e.node.res.getHeader(t);r?(Array.isArray(r)||(r=[r.toString()]),e.node.res.setHeader(t,[...r,n])):e.node.res.setHeader(t,n)}const Ot=Mt;function Tt(e,t){if(t&&t.length>0)for(const n of t)qt(e,n);else for(const[n]of Object.entries(vt(e)))qt(e,n)}function qt(e,t){return e.node.res.removeHeader(t)}function Ht(e){if(!e||"object"!=typeof e)return!1;if("function"==typeof e.pipe){if("function"==typeof e._read)return!0;if("function"==typeof e.abort)return!0}return"function"==typeof e.pipeTo}function jt(e){return"undefined"!=typeof Response&&e instanceof Response}function Lt(e,t){if(!t||"object"!=typeof t)throw new Error("[h3] Invalid stream provided.");if(e.node.res._data=t,!e.node.res.socket)return e._handled=!0,Promise.resolve();if(we(t,"pipeTo")&&"function"==typeof t.pipeTo)return t.pipeTo(new WritableStream({write(t){e.node.res.write(t)}})).then((()=>{e.node.res.end()}));if(we(t,"pipe")&&"function"==typeof t.pipe)return new Promise(((n,r)=>{t.pipe(e.node.res),t.on&&(t.on("end",(()=>{e.node.res.end(),n()})),t.on("error",(e=>{r(e)}))),e.node.res.on("close",(()=>{t.abort&&t.abort()}))}));throw new Error("[h3] Invalid or incompatible stream provided.")}const Nt=()=>{};function Bt(e,t,n=Nt){if(!e.node.res.socket)return void n();("string"==typeof t||Array.isArray(t))&&(t={link:t}),t.link&&(t.link=Array.isArray(t.link)?t.link:t.link.split(","));const r=Object.entries(t).map((e=>[e[0].toLowerCase(),e[1]]));if(0===r.length)return void n();let s="HTTP/1.1 103 Early Hints";t.link&&(s+=`\r\nLink: ${t.link.join(", ")}`);for(const[o,i]of r)"link"!==o&&(s+=`\r\n${o}: ${i}`);e.node.res.socket?e.node.res.socket.write(`${s}\r\n\r\n`,"utf8",n):n()}function Dt(e,t){for(const[n,r]of t.headers)"set-cookie"===n?e.node.res.appendHeader(n,lt(r)):e.node.res.setHeader(n,r);if(t.status&&(e.node.res.statusCode=it(t.status,e.node.res.statusCode)),t.statusText&&(e.node.res.statusMessage=ot(t.statusText)),t.redirected&&e.node.res.setHeader("location",t.url),t.body)return Lt(e,t.body);e.node.res.end()}function Pt(e,t,n){const r=n?.serializer??ht,s=function(e){return"function"==typeof e&&(e=e()),Symbol.iterator in e?e[Symbol.iterator]():Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e}(t);return Lt(e,new ReadableStream({async pull(e){const{value:t,done:n}=await s.next();if(void 0!==t){const n=r(t);void 0!==n&&e.enqueue(n)}n&&e.close()},cancel(){s.return?.()}}))}function It(e){const t=Be(e,"origin"),n=Be(e,"access-control-request-method");return"OPTIONS"===e.method&&!!t&&!!n}function $t(e,t){const{origin:n}=t;return!e||!n||"*"===n||"null"===n||(Array.isArray(n)?n.some((t=>t instanceof RegExp?t.test(e):e===t)):n(e))}function Ut(e,t){const{origin:n}=t,r=Be(e,"origin");return r&&n&&"*"!==n?"string"==typeof n?{"access-control-allow-origin":n,vary:"origin"}:$t(r,t)?{"access-control-allow-origin":r,vary:"origin"}:{}:{"access-control-allow-origin":"*"}}function Ft(e){const{credentials:t}=e;return t?{"access-control-allow-credentials":"true"}:{}}function Wt(e){const{exposeHeaders:t}=e;return t?"*"===t?{"access-control-expose-headers":t}:{"access-control-expose-headers":t.join(",")}:{}}function zt(e,t){Rt(e,Ut(e,t)),Rt(e,Ft(t)),Rt(e,Wt(t)),Rt(e,function(e){const{methods:t}=e;return t?"*"===t?{"access-control-allow-methods":"*"}:t.length>0?{"access-control-allow-methods":t.join(",")}:{}:{}}(t)),Rt(e,function(e,t){const{allowHeaders:n}=t;if(!n||"*"===n||0===n.length){const t=Be(e,"access-control-request-headers");return t?{"access-control-allow-headers":t,vary:"access-control-request-headers"}:{}}return{"access-control-allow-headers":n.join(","),vary:"access-control-request-headers"}}(e,t))}function Kt(e,t){Rt(e,Ut(e,t)),Rt(e,Ft(t)),Rt(e,Wt(t))}function Jt(e,t){const n=function(e={}){return d(e,{origin:"*",methods:"*",allowHeaders:"*",exposeHeaders:"*",credentials:!1,maxAge:!1,preflight:{statusCode:204}})}(t);return It(e)?(zt(e,t),yt(e,n.preflight.statusCode),!0):(Kt(e,t),!1)}async function Vt(e,t={}){const n=[];!1!==t.ip&&n.push(ze(e,{xForwardedFor:t.xForwardedFor})),!0===t.method&&n.push(e.method),!0===t.path&&n.push(e.path),!0===t.userAgent&&n.push(Be(e,"user-agent"));const r=n.filter(Boolean).join("|");if(!r)return null;if(!1===t.hash)return r;const s=await q.subtle.digest(t.hash||"SHA-1",(new TextEncoder).encode(r));return[...new Uint8Array(s)].map((e=>e.toString(16).padStart(2,"0"))).join("")}const Gt=new Set(["PATCH","POST","PUT","DELETE"]),Yt=new Set(["transfer-encoding","connection","keep-alive","upgrade","expect","host","accept"]);async function Xt(e,t,n={}){let r,s;Gt.has(e.method)&&(n.streamRequest?(r=et(e),s="half"):r=await Ge(e,!1).catch((()=>{})));const o=n.fetchOptions?.method||e.method,i=function(e,...t){const n=t.filter(Boolean);if(0===n.length)return e;const r=new Headers(e);for(const s of n)for(const[e,t]of Object.entries(s))void 0!==t&&r.set(e,t);return r}(Qt(e),n.fetchOptions?.headers,n.headers);return Zt(e,t,{...n,fetchOptions:{method:o,body:r,duplex:s,...n.fetchOptions,headers:i}})}async function Zt(e,t,n={}){const r=await tn(n.fetch)(t,{headers:n.headers,ignoreResponseError:!0,...n.fetchOptions});e.node.res.statusCode=it(r.status,e.node.res.statusCode),e.node.res.statusMessage=ot(r.statusText);const s=[];for(const[o,i]of r.headers.entries())"content-encoding"!==o&&"content-length"!==o&&("set-cookie"!==o?e.node.res.setHeader(o,i):s.push(...lt(i)));if(s.length>0&&e.node.res.setHeader("set-cookie",s.map((e=>(n.cookieDomainRewrite&&(e=nn(e,n.cookieDomainRewrite,"domain")),n.cookiePathRewrite&&(e=nn(e,n.cookiePathRewrite,"path")),e)))),n.onResponse&&await n.onResponse(e,r),void 0!==r._data)return r._data;if(!e.handled){if(!1===n.sendStream){const t=new Uint8Array(await r.arrayBuffer());return e.node.res.end(t)}if(r.body)for await(const t of r.body)e.node.res.write(t);return e.node.res.end()}}function Qt(e){const t=Object.create(null),n=Le(e);for(const r in n)Yt.has(r)||(t[r]=n[r]);return t}function en(e,t,n,r){return tn(r?.fetch)(t,{...n,context:n?.context||e.context,headers:{...Qt(e),...n?.headers}})}function tn(e){if(e)return e;if(globalThis.fetch)return globalThis.fetch;throw new Error("fetch is not available. Try importing `node-fetch-native/polyfill` for Node.js.")}function nn(e,t,n){const r="string"==typeof t?{"*":t}:t;return e.replace(new RegExp(`(;\\s*${n}=)([^;]+)`,"gi"),((e,t,n)=>{let s;if(n in r)s=r[n];else{if(!("*"in r))return e;s=r["*"]}return s?t+s:""}))}const rn=Symbol("getSession"),sn="h3",on={path:"/",secure:!0,httpOnly:!0};async function an(e,t){const n=t.name||sn;await cn(e,t);const r={get id(){return e.context.sessions?.[n]?.id},get data(){return e.context.sessions?.[n]?.data||{}},update:async n=>(await dn(e,t,n),r),clear:async()=>(await hn(e,t),r)};return r}async function cn(e,t){const n=t.name||sn;e.context.sessions||(e.context.sessions=Object.create(null));const r=e.context.sessions[n];if(r)return r[rn]||r;const s={id:"",createdAt:0,data:Object.create(null)};let o;if(e.context.sessions[n]=s,!1!==t.sessionHeader){const r="string"==typeof t.sessionHeader?t.sessionHeader.toLowerCase():`x-${n.toLowerCase()}-session`,s=e.node.req.headers[r];"string"==typeof s&&(o=s)}if(o||(o=ct(e,n)),o){const r=ln(e,t,o).catch((()=>{})).then((t=>(Object.assign(s,t),delete e.context.sessions[n][rn],s)));e.context.sessions[n][rn]=r,await r}return s.id||(s.id=t.generateId?.()??(t.crypto||q).randomUUID(),s.createdAt=Date.now(),await dn(e,t)),s}async function dn(e,t,n){const r=t.name||sn,s=e.context.sessions?.[r]||await cn(e,t);if("function"==typeof n&&(n=n(s.data)),n&&Object.assign(s.data,n),!1!==t.cookie){dt(e,r,await un(e,t),{...on,expires:t.maxAge?new Date(s.createdAt+1e3*t.maxAge):void 0,...t.cookie})}return s}async function un(e,t){const n=t.name||sn,r=e.context.sessions?.[n]||await cn(e,t);return await V(t.crypto||q,r,t.password,{...D,ttl:t.maxAge?1e3*t.maxAge:0,...t.seal})}async function ln(e,t,n){const r=await G(t.crypto||q,n,t.password,{...D,ttl:t.maxAge?1e3*t.maxAge:0,...t.seal});if(t.maxAge){if(Date.now()-(r.createdAt||Number.NEGATIVE_INFINITY)>1e3*t.maxAge)throw new Error("Session expired!")}return r}async function hn(e,t){const n=t.name||sn;e.context.sessions?.[n]&&delete e.context.sessions[n],await dt(e,n,"",{...on,...t.cookie})}function fn(e){let t="";return e.id&&(t+=`id: ${e.id}\n`),e.event&&(t+=`event: ${e.event}\n`),"number"==typeof e.retry&&Number.isInteger(e.retry)&&(t+=`retry: ${e.retry}\n`),t+=`data: ${e.data}\n\n`,t}function pn(e){const t={"Content-Type":"text/event-stream","Cache-Control":"private, no-cache, no-store, no-transform, must-revalidate, max-age=0","X-Accel-Buffering":"no"};(function(e){return void 0!==De(e,":path")&&void 0!==De(e,":method")})(e)||(t.Connection="keep-alive"),xt(e,t)}var yn=Object.defineProperty,mn=(e,t,n)=>(((e,t,n)=>{t in e?yn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class wn{constructor(e,t={}){mn(this,"_h3Event"),mn(this,"_transformStream",new TransformStream),mn(this,"_writer"),mn(this,"_encoder",new TextEncoder),mn(this,"_writerIsClosed",!1),mn(this,"_paused",!1),mn(this,"_unsentData"),mn(this,"_disposed",!1),mn(this,"_handled",!1),this._h3Event=e,this._writer=this._transformStream.writable.getWriter(),this._writer.closed.then((()=>{this._writerIsClosed=!0})),!1!==t.autoclose&&this._h3Event.node.req.on("close",(()=>this.close()))}async push(e){if("string"!=typeof e)if(Array.isArray(e)){if(0===e.length)return;if("string"==typeof e[0]){const t=[];for(const n of e)t.push({data:n});return void(await this._sendEvents(t))}await this._sendEvents(e)}else await this._sendEvent(e);else await this._sendEvent({data:e})}async _sendEvent(e){this._writerIsClosed||(!this._paused||this._unsentData?this._paused?this._unsentData+=fn(e):await this._writer.write(this._encoder.encode(fn(e))).catch():this._unsentData=fn(e))}async _sendEvents(e){if(this._writerIsClosed)return;const t=function(e){let t="";for(const n of e)t+=fn(n);return t}(e);!this._paused||this._unsentData?this._paused?this._unsentData+=t:await this._writer.write(this._encoder.encode(t)).catch():this._unsentData=t}pause(){this._paused=!0}get isPaused(){return this._paused}async resume(){this._paused=!1,await this.flush()}async flush(){this._writerIsClosed||this._unsentData?.length&&(await this._writer.write(this._encoder.encode(this._unsentData)),this._unsentData=void 0)}async close(){if(!this._disposed){if(!this._writerIsClosed)try{await this._writer.close()}catch{}this._h3Event._handled&&this._handled&&!this._h3Event.node.res.closed&&this._h3Event.node.res.end(),this._disposed=!0}}onClosed(e){this._writer.closed.then(e),this._h3Event.node?.req.on("close",e)}async send(){pn(this._h3Event),mt(this._h3Event,200),this._h3Event._handled=!0,this._handled=!0,await Lt(this._h3Event,this._transformStream.readable)}}function gn(e,t){return new wn(e,t)}async function _n(t,n){if("GET"!==t.method&&"HEAD"!==t.method){if(!n.fallthrough)throw ve({statusMessage:"Method Not Allowed",statusCode:405});return!1}const i=r(s(e(o(t.path).pathname))),a=function(e,t){if(!t||!e)return[];return String(e||"").split(",").map((e=>t[e.trim()])).filter(Boolean)}(Be(t,"accept-encoding"),n.encodings);a.length>1&&Ct(t,"vary","accept-encoding");let c,d=i;const u=function(e,t,n){const r=[];for(const s of["",...n])for(const n of[...t,""])r.push(`${e}${s}${n}`);return r}(i,a,n.indexNames||["/index.html"]);for(const e of u){const t=await n.getMeta(e);if(t){c=t,d=e;break}}if(!c){if(!n.fallthrough)throw ve({statusMessage:"Cannot find static asset "+d,statusCode:404});return!1}c.etag&&!At(t,"etag")&&Ct(t,"etag",c.etag);if(c.etag&&Be(t,"if-none-match")===c.etag)return mt(t,304,"Not Modified"),pt(t,"");if(c.mtime){const e=new Date(c.mtime),n=Be(t,"if-modified-since");if(n&&new Date(n)>=e)return mt(t,304,"Not Modified"),pt(t,null);At(t,"last-modified")||Ct(t,"last-modified",e.toUTCString())}if(c.type&&!At(t,"content-type")&&Ct(t,"content-type",c.type),c.encoding&&!At(t,"content-encoding")&&Ct(t,"content-encoding",c.encoding),void 0!==c.size&&c.size>0&&!At(t,"content-length")&&Ct(t,"content-length",c.size),"HEAD"===t.method)return pt(t,null);const l=await n.getContents(d);return Ht(l)?Lt(t,l):pt(t,l)}function bn(e){return e}function vn(e){return kn({handler(){throw ve({statusCode:426,statusMessage:"Upgrade Required"})},websocket:e})}var An=Object.defineProperty,xn=(e,t,n)=>(((e,t,n)=>{t in e?An(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class En{constructor(e,t){xn(this,"__is_event__",!0),xn(this,"node"),xn(this,"web"),xn(this,"context",{}),xn(this,"_method"),xn(this,"_path"),xn(this,"_headers"),xn(this,"_requestBody"),xn(this,"_handled",!1),this.node={req:e,res:t}}get method(){return this._method||(this._method=(this.node.req.method||"GET").toUpperCase()),this._method}get path(){return this._path||this.node.req.url||"/"}get headers(){return this._headers||(this._headers=function(e){const t=new Headers;for(const[n,r]of Object.entries(e))if(Array.isArray(r))for(const e of r)t.append(n,e);else r&&t.set(n,r);return t}(this.node.req.headers)),this._headers}get handled(){return this._handled||this.node.res.writableEnded||this.node.res.headersSent}respondWith(e){return Promise.resolve(e).then((e=>Dt(this,e)))}toString(){return`[${this.method}] ${this.path}`}toJSON(){return this.toString()}get req(){return this.node.req}get res(){return this.node.res}}function Cn(e){return we(e,"__is_event__")}function Sn(e,t){return new En(e,t)}function kn(e){if("function"==typeof e)return e.__is_handler__=!0,e;const t={onRequest:Rn(e.onRequest),onBeforeResponse:Rn(e.onBeforeResponse)},n=n=>async function(e,t,n){if(n.onRequest)for(const o of n.onRequest)if(await o(e),e.handled)return;const r=await t(e),s={body:r};if(n.onBeforeResponse)for(const o of n.onBeforeResponse)await o(e,s);return s.body}(n,e.handler,t);return n.__is_handler__=!0,n.__resolve__=e.handler.__resolve__,n.__websocket__=e.websocket,n}function Rn(e){return e?Array.isArray(e)?e:[e]:void 0}const Mn=kn;function On(e){return e}function Tn(e){return e}function qn(e){return we(e,"__is_handler__")}function Hn(e,t,n){return qn(e)||console.warn("[h3] Implicit event handler conversion is deprecated. Use `eventHandler()` or `fromNodeMiddleware()` to define event handlers.",n&&"/"!==n?`\n     Route: ${n}`:"",`\n     Handler: ${e}`),e}function jn(e){let t=e;const n=Mn((e=>{if(t)return t(e)}));return n.set=e=>{t=e},n}function Ln(e){let t,n;const r=()=>n?Promise.resolve(n):(t||(t=Promise.resolve(e()).then((e=>{const t=e.default||e;if("function"!=typeof t)throw new TypeError("Invalid lazy handler result. It should be a function:",t);return n={handler:Hn(e.default||e)},n}))),t),s=Mn((e=>n?n.handler(e):r().then((t=>t.handler(e)))));return s.__resolve__=r,s}const Nn=Ln,Bn=globalThis.Headers,Dn=globalThis.Response;function Pn(e={}){const t=[],n=$n(t,e),r=function(e){return async t=>{let n;for(const r of e){if("/"===r.route&&!r.handler.__resolve__)continue;if(!t.startsWith(r.route))continue;if(n=t.slice(r.route.length)||"/",r.match&&!r.match(n,void 0))continue;let e={route:r.route,handler:r.handler};if(e.handler.__resolve__){const t=await e.handler.__resolve__(n);if(!t)continue;e={...e,...t,route:a(e.route||"/",t.route||"/")}}return e}}}(t);n.__resolve__=r;const s=function(e){let t;return()=>(t||(t=e()),t)}((()=>{return t=r,{...e.websocket,async resolve(e){const{pathname:n}=o(e.url||"/"),r=await t(n);return r?.handler?.__websocket__||{}}};var t})),i={use:(e,t,n)=>In(i,e,t,n),resolve:r,handler:n,stack:t,options:e,get websocket(){return s()}};return i}function In(e,t,n,r){if(Array.isArray(t))for(const s of t)In(e,s,n,r);else if(Array.isArray(n))for(const s of n)In(e,t,s,r);else"string"==typeof t?e.stack.push(Un({...r,route:t,handler:n})):"function"==typeof t?e.stack.push(Un({...n,handler:t})):e.stack.push(Un({...t}));return e}function $n(e,t){const n=t.debug?2:void 0;return Mn((async r=>{r.node.req.originalUrl=r.node.req.originalUrl||r.node.req.url||"/";const s=r._path||r.node.req.url||"/";let o;t.onRequest&&await t.onRequest(r);for(const i of e){if(i.route.length>1){if(!s.startsWith(i.route))continue;o=s.slice(i.route.length)||"/"}else o=s;if(i.match&&!i.match(o,r))continue;r._path=o,r.node.req.url=o;const e=await i.handler(r),a=void 0===e?void 0:await e;if(void 0!==a){const e={body:a};return t.onBeforeResponse&&await t.onBeforeResponse(r,e),await Fn(r,e.body,n),void(t.onAfterResponse&&await t.onAfterResponse(r,e))}if(r.handled)return void(t.onAfterResponse&&await t.onAfterResponse(r,void 0))}if(!r.handled)throw ve({statusCode:404,statusMessage:`Cannot find any path matching ${r.path||"/"}.`});t.onAfterResponse&&await t.onAfterResponse(r,void 0)}))}function Un(t){let n=t.handler;return n.handler&&(n=n.handler),t.lazy?n=Nn(n):qn(n)||(n=Hn(n,0,t.route)),{route:e(t.route),match:t.match,handler:n}}function Fn(e,t,n){if(null===t)return yt(e);if(t){if(jt(t))return Dt(e,t);if(Ht(t))return Lt(e,t);if(t.buffer)return pt(e,t);if(t.arrayBuffer&&"function"==typeof t.arrayBuffer)return t.arrayBuffer().then((n=>pt(e,Buffer.from(n),t.type)));if(t instanceof Error)throw ve(t);if("function"==typeof t.end)return!0}const r=typeof t;if("string"===r)return pt(e,t,rt.html);if("object"===r||"boolean"===r||"number"===r)return pt(e,JSON.stringify(t,void 0,n),rt.json);if("bigint"===r)return pt(e,t.toString(),rt.json);throw ve({statusCode:500,statusMessage:`[h3] Cannot send ${r} as response.`})}const Wn=["connect","delete","get","head","options","post","put","trace","patch"];function zn(e={}){const t=x({}),n={};let r;const o={},i=(e,r,s)=>{let a=n[e];if(a||(n[e]=a={path:e,handlers:{}},t.insert(e,a)),Array.isArray(s))for(const t of s)i(e,r,t);else a.handlers[s]=Hn(r,0,e);return o};o.use=o.add=(e,t,n)=>i(e,t,n||"all");for(const s of Wn)o[s]=(e,t)=>o.add(e,t,s);const a=(e="/",n="get")=>{const s=e.indexOf("?");-1!==s&&(e=e.slice(0,Math.max(0,s)));const o=t.lookup(e);if(!o||!o.handlers)return{error:ve({statusCode:404,name:"Not Found",statusMessage:`Cannot find any route matching ${e||"/"}.`})};let i=o.handlers[n]||o.handlers.all;if(!i){r||(r=k(t));const s=r.matchAll(e).reverse();for(const e of s){if(e.handlers[n]){i=e.handlers[n],o.handlers[n]=o.handlers[n]||i;break}if(e.handlers.all){i=e.handlers.all,o.handlers.all=o.handlers.all||i;break}}}return i?{matched:o,handler:i}:{error:ve({statusCode:405,name:"Method Not Allowed",statusMessage:`Method ${n} is not allowed on this route.`})}},c=e.preemptive||e.preemtive;return o.handler=Mn((e=>{const t=a(e.path,e.method.toLowerCase());if("error"in t){if(c)throw t.error;return}e.context.matchedRoute=t.matched;const n=t.matched.params||{};return e.context.params=n,Promise.resolve(t.handler(e)).then((e=>void 0===e&&c?null:e))})),o.handler.__resolve__=async e=>{e=s(e);const t=a(e);if("error"in t)return;let n={route:t.matched.path,handler:t.handler};if(t.handler.__resolve__){const r=await t.handler.__resolve__(e);if(!r)return;n={...n,...r}}return n},o}const Kn=e=>e,Jn=e=>e;function Vn(e){if(qn(e))return e;if("function"!=typeof e)throw new TypeError("Invalid handler. It should be a function:",e);return Mn((t=>Xn(e,t.node.req,t.node.res)))}function Gn(e){return async function(t,n){const r=Sn(t,n);try{await e.handler(r)}catch(s){const t=ve(s);if(xe(s)||(t.unhandled=!0),e.options.onError&&await e.options.onError(t,r),r.handled)return;(t.unhandled||t.fatal)&&console.error("[h3]",t.fatal?"[fatal]":"[unhandled]",t),await Ae(r,t,!!e.options.debug)}}}function Yn(e){return function(t,n){return Xn(e,t,n)}}function Xn(e,t,n){const r=e.length>2;return new Promise(((s,o)=>{const i=e=>(r&&(n.off("close",i),n.off("error",i)),e?o(ve(e)):s(void 0));try{const o=e(t,n,i);r&&void 0===o?(n.once("close",i),n.once("error",i)):s(o)}catch(a){i(a)}}))}function Zn(e){return t=>er(e,t)}function Qn(e){return Mn((async t=>{const n=await e({method:t.method,path:t.path,headers:Object.fromEntries(t.headers.entries()),body:et(t),context:t.context});mt(t,n.status,n.statusText);for(const[e,r]of n.headers)Ct(t,e,r);return n.body}))}async function er(e,t){const n=t.path,r=(t.method||"GET").toUpperCase(),s=new Headers(t.headers),o=new fe,i=new ye(o);o.method=r,o.url=n,o.headers=Object.fromEntries(s.entries());const a=Sn(o,i);a._method=r,a._path=n,a._headers=s,t.body&&(a._requestBody=t.body),t._eventOverrides&&Object.assign(a,t._eventOverrides),t.context&&Object.assign(a.context,t.context);try{await e.handler(a)}catch(c){const t=ve(c);xe(c)||(t.unhandled=!0),e.options.onError&&await e.options.onError(t,a),a.handled||((t.unhandled||t.fatal)&&console.error("[h3]",t.fatal?"[fatal]":"[unhandled]",t),await Ae(a,t,!!e.options.debug))}return{status:i.statusCode,statusText:i.statusMessage,headers:tr(i._headers),body:i._data}}function tr(e){const t=[],n=[];for(const r in e){const s=r.toLowerCase();if("set-cookie"===s){n.push(...lt(e["set-cookie"]));continue}const o=e[s];if(Array.isArray(o))for(const e of o)t.push([s,e]);else void 0!==o&&t.push([s,String(o)])}if(n.length>0)for(const r of n)t.push(["set-cookie",r]);return t}function nr(e){return(t,n)=>async function(e,t,n){const r=new URL(t.url),s=await er(e,{_eventOverrides:{web:{request:t,url:r}},context:n,method:t.method,path:r.pathname+r.search,headers:t.headers,body:t.body}),o=sr.has(s.status)||"HEAD"===t.method?null:s.body;return new Response(o,{status:s.status,statusText:s.statusText,headers:s.headers})}(e,t,n)}function rr(e){return Mn((t=>e(We(t),t.context)))}const sr=new Set([101,204,205,304]);export{be as H3Error,En as H3Event,Bn as H3Headers,Dn as H3Response,rt as MIMES,Kt as appendCorsHeaders,zt as appendCorsPreflightHeaders,Ot as appendHeader,Rt as appendHeaders,Mt as appendResponseHeader,kt as appendResponseHeaders,je as assertMethod,Xn as callNodeListener,Tt as clearResponseHeaders,hn as clearSession,Pn as createApp,$n as createAppEventHandler,ve as createError,Sn as createEvent,gn as createEventStream,zn as createRouter,_t as defaultContentType,kn as defineEventHandler,Ln as defineLazyEventHandler,Kn as defineNodeListener,Jn as defineNodeMiddleware,On as defineRequestMiddleware,Tn as defineResponseMiddleware,bn as defineWebSocket,vn as defineWebSocketHandler,ut as deleteCookie,jn as dynamicEventHandler,Mn as eventHandler,en as fetchWithEvent,Vn as fromNodeMiddleware,Qn as fromPlainHandler,rr as fromWebHandler,ct as getCookie,De as getHeader,Ne as getHeaders,qe as getMethod,Qt as getProxyRequestHeaders,ke as getQuery,Vt as getRequestFingerprint,Be as getRequestHeader,Le as getRequestHeaders,Pe as getRequestHost,ze as getRequestIP,Ue as getRequestPath,Ie as getRequestProtocol,Fe as getRequestURL,et as getRequestWebStream,At as getResponseHeader,vt as getResponseHeaders,wt as getResponseStatus,gt as getResponseStatusText,Te as getRouterParam,Me as getRouterParams,cn as getSession,Re as getValidatedQuery,Oe as getValidatedRouterParams,nt as handleCacheHeaders,Jt as handleCors,$t as isCorsOriginAllowed,xe as isError,Cn as isEvent,qn as isEventHandler,He as isMethod,It as isPreflightRequest,Ht as isStream,jt as isWebResponse,Nn as lazyEventHandler,at as parseCookies,Yn as promisifyNodeListener,Xt as proxyRequest,Ye as readBody,Qe as readFormData,Ze as readMultipartFormData,Ge as readRawBody,Xe as readValidatedBody,qt as removeResponseHeader,it as sanitizeStatusCode,ot as sanitizeStatusMessage,un as sealSession,pt as send,Ae as sendError,Pt as sendIterable,yt as sendNoContent,Zt as sendProxy,bt as sendRedirect,Lt as sendStream,Dt as sendWebResponse,_n as serveStatic,dt as setCookie,St as setHeader,Et as setHeaders,Ct as setResponseHeader,xt as setResponseHeaders,mt as setResponseStatus,lt as splitCookiesString,Hn as toEventHandler,Gn as toNodeListener,Zn as toPlainHandler,nr as toWebHandler,We as toWebRequest,ln as unsealSession,dn as updateSession,In as use,me as useBase,an as useSession,Bt as writeEarlyHints};
